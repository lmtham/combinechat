<script>
  document.addEventListener("DOMContentLoaded", function () {
      // Step 1: Initialize Vapi Chat Widget
      const assistant = "afa7ab83-0e0b-4895-8bcf-1726205ee9dc"; // Replace with your assistant ID
      const apiKey = "74f983f2-3303-4e57-a098-6c191d3618e1"; // Replace with your public API key

      const buttonConfig = {
          position: "bottom-right",
          offset: "40px",
          width: "50px",
          height: "50px",
          idle: {
              color: `rgb(93, 254, 202)`, 
              type: "pill", 
              title: "Have a quick question?", 
              subtitle: "Talk with our AI assistant",
              icon: `https://unpkg.com/lucide-static@0.321.0/icons/message-square.svg`,
          }
      };

      const vapiInstance = new VapiWidget(assistant, apiKey, buttonConfig);

      // Step 2: Hide n8n's default toggle button completely
      const style = document.createElement('style');
      style.innerHTML = `#n8n-chat-toggle { display: none !important; }`;
      document.head.appendChild(style);

      // Step 3: Load n8n chat widget without toggle button
      import("https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js").then(({ createChat }) => {
          const chatInstance = createChat({
              webhookUrl: 'https://n8ncloud2.onrender.com/webhook/2f82c208-de56-4c9d-8028-c5bfbe4f1428/chat',
              mode: 'window',
              showWelcomeScreen: false,
          });

          // Step 4: Ensure clicking Vapi button opens n8n chat
          const checkVapiButton = setInterval(() => {
              const vapiButton = document.querySelector('.vapi-widget-button');
              if (vapiButton) {
                  clearInterval(checkVapiButton);
                  vapiButton.addEventListener('click', () => {
                      chatInstance.open();
                  });
              }
          }, 500);
      });
  });
</script>
